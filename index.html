<!DOCTYPE html>
<html>
<head>
    <title>Realtime Messages (Firebase)</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background: #f4f4f4;
        }
        button {
            margin: 0 2px;
            padding: 4px 8px;
        }
    </style>
</head>
<body>

    <h1>Realtime Messages (Firebase)</h1>

    <table id="messages-table">
        <thead>
            <tr>
                <th>Message</th>
                <th>Timestamp</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="messages-body">
            <tr><td colspan="3">Loading...</td></tr>
        </tbody>
    </table>

    <h2>Add a Message</h2>
    <input type="text" id="new-message-input" placeholder="Type a new message">
    <button onclick="updateData()">Save to Database</button>

    <!-- Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAN6Ao-5Cwr7Dx5uTXE0N_DLQROwgB_0hE",
            authDomain: "test-f7c0f.firebaseapp.com",
            databaseURL: "https://test-f7c0f-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "test-f7c0f",
            storageBucket: "test-f7c0f.appspot.com",
            messagingSenderId: "267559731634",
            appId: "1:267559731634:web:5d27671f8a5109476324ab"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const messagesRef = database.ref('messages');

        const messagesBody = document.getElementById('messages-body');

        // Render table rows
        function renderRow(key, data) {
            const row = document.createElement('tr');
            row.setAttribute('id', key);

            row.innerHTML = `
                <td>${data.text}</td>
                <td>${data.timestamp}</td>
                <td>
                    <button onclick="editMessage('${key}', '${data.text}')">Edit</button>
                    <button onclick="deleteMessage('${key}')">Delete</button>
                </td>
            `;
            return row;
        }

        // Listen for added rows
        messagesRef.on('child_added', (snapshot) => {
            const data = snapshot.val();
            const key = snapshot.key;

            if (messagesBody.querySelector("td[colspan]")) {
                messagesBody.innerHTML = ""; // clear "Loading..."
            }
            messagesBody.appendChild(renderRow(key, data));
        });

        // Listen for updated rows
        messagesRef.on('child_changed', (snapshot) => {
            const data = snapshot.val();
            const key = snapshot.key;
            const row = document.getElementById(key);
            if (row) {
                row.replaceWith(renderRow(key, data));
            }
        });

        // Listen for removed rows
        messagesRef.on('child_removed', (snapshot) => {
            const key = snapshot.key;
            const row = document.getElementById(key);
            if (row) row.remove();
        });

        // Add message
        function updateData() {
            const input = document.getElementById('new-message-input');
            const newMessage = input.value.trim();

            if (newMessage) {
                messagesRef.push({
                    text: newMessage,
                    timestamp: new Date().toLocaleString()
                });
                input.value = '';
            } else {
                alert("Please enter a message.");
            }
        }

        // Edit message
        function editMessage(key, oldText) {
            const newText = prompt("Edit your message:", oldText);
            if (newText && newText.trim() !== "") {
                messagesRef.child(key).update({
                    text: newText,
                    timestamp: new Date().toLocaleString()
                });
            }
        }

        // Delete message
        function deleteMessage(key) {
            if (confirm("Are you sure you want to delete this message?")) {
                messagesRef.child(key).remove();
            }
        }
    </script>

</body>
</html>



